## 요약(Exec)

* 현재 문서 세트 기준, GPTs에서 **사용자 입력(텍스트/PDF/스크린샷) → LDG_PAYLOAD/LDG_AUDIT → Commons JSON → `make_cipl_set.py` 실행 → CIPL 4‑sheet Excel 제공** 구조는 일관되게 정의되어 있습니다.  
* 다만 “기본 정보만으로도 생성” 요구는, **현 템플릿의 `commons/static_parties` 필수키가 누락되면 KeyError로 빌드가 실패**할 수 있어(=설계 충돌) **프리필(placeholder) 어댑터**가 필요합니다. 
* 운영 관점에서, Custom GPT가 **실제 파일(.xlsx) 다운로드 링크를 안정적으로 제공**하려면 **Code Interpreter & Data Analysis 활성화가 필수**입니다. (웹 조회일 2026-01-14 기준 “Updated: 3 days ago”) ([OpenAI Help Center][1])
* Knowledge는 “참조용 컨텍스트”로 유효하나, **멀티컬럼 PDF 취약/이미지 텍스트 미처리** 등의 제한을 전제로 파이프라인을 설계해야 합니다. (웹 조회일 2026-01-14 기준 “Updated: 4 days ago”) ([OpenAI Help Center][2])
* 따라서 개선의 핵심은 **(1) 최소입력 허용(프리필) + (2) 스키마/검증 자동화 + (3) SSoT/템플릿 버전관리(장기적으로 Actions+백엔드 분리)** 입니다.  

---

## EN Sources (≤3)

```text
1) OpenAI Help Center — “Why can't I download files generated by my custom GPT?” (Updated: 3 days ago; accessed 2026-01-14)
   https://help.openai.com/en/articles/11325361-why-cant-i-download-files-generated-by-my-custom-gpt

2) OpenAI Help Center — “Knowledge in GPTs” (Updated: 4 days ago; accessed 2026-01-14)
   https://help.openai.com/en/articles/8843948-knowledge-in-gpts

3) OpenAI Platform Docs — “Production notes on GPT Actions” (accessed 2026-01-14)
   https://platform.openai.com/docs/actions/production
```

---

## 시스템 구조 재확인(End-to-End) — 핵심 흐름(현 문서 SSOT 기준)

### 1) 문서 체계(레벨)와 실행 우선순위

* Level 1(정책/표준) → Level 2(실행 가이드) → Level 3(기술 파이프라인)로 계층이 정리되어 있고, 실행 우선순위는 **GPTS지침 → GUIDE → PIPELINE → AutoBuild → Full Guide**로 명시되어 있습니다.  

### 2) 데이터 플로우(고정)

* **사용자 입력(Text/PDF/이미지)**
  → (GPT) **LDG_PAYLOAD v2.4 + LDG_AUDIT v2.4 + Auto Guard Summary**
  → (변환) **Commons Mode JSON(`commons`, `static_parties`, rider optional)**
  → (빌드) **`make_cipl_set.py` → `CIPL.py.make_4page_data_dicts()` → 4‑sheet Excel 생성**
  → (산출) **CIPL Excel + Audit 요약**
  근거: GUIDE의 전체 워크플로우 , CIPL TOTAL GUIDE의 “문서 간 데이터 흐름” , PIPELINE의 다이어그램 

### 3) 빌더 입력 모드 2종(중요)

* **Mode 1: Commons Mode** = `{commons, static_parties, ci_rider_items?, pl_rider_items?}`
* **Mode 2: Expanded Mode** = `{ci_p1, ci_rider_p2, pl_p1, pl_rider_p2}`
  `make_cipl_set.py`가 **입력 모드 자동 감지**를 수행한다고 정리되어 있습니다.  

---

## 핵심 리스크(“기본 정보만으로도 생성”) — 필수키 강제(_require) 충돌

현 설계에서 “무질의(Zero‑question)”는 맞지만, **Excel 빌더는 `commons/static_parties` 필수키 누락 시 KeyError로 실패 가능**합니다. 필수키 목록이 명시되어 있습니다. 

> 결론: “기본 정보만으로도 생성”을 **실제로** 만족하려면, GPT 단계에서 **(A) 필수키 프리필(빈값/0.00) 어댑터** 또는 **(B) 템플릿 코드의 `_require` 정책 완화** 중 하나가 필요합니다. (HallucinationBan을 지키려면 값 ‘추정’이 아니라 “빈칸 유지 + 경고”가 정답입니다.) 

---

## 표 (No|Item|Value|Risk|Evidence/가정)

| No | Item                 | Value                                                               | Risk                  | Evidence/가정                                       |
| -: | -------------------- | ------------------------------------------------------------------- | --------------------- | ------------------------------------------------- |
|  1 | 목표 산출물(항상)           | Auto Guard Summary + LDG_PAYLOAD v2.4 + LDG_AUDIT v2.4 + CIPL Excel | 낮음                    | GPTS 기본 산출물로 고정                                   |
|  2 | 기본 동작(Zero‑question) | 추가 질문 없이 최대한 생성, 불확실은 NULL/가정 경고                                    | 중간(품질)                | 지침에 명시                                            |
|  3 | Excel 다운로드 전제        | Code Interpreter & Data Analysis 활성화 필요                             | 높음(미설정 시 다운로드 실패)     | “업로드 상태 오류 해결 = 기능 활성화” ([OpenAI Help Center][1]) |
|  4 | Knowledge 한계         | 멀티컬럼 PDF 취약, 이미지 텍스트는 미처리(텍스트만)                                     | 중간(추출 누락)             | Knowledge 동작/제한 명시 ([OpenAI Help Center][2])      |
|  5 | Commons 필수키          | `pol/pod/.../total_cif_usd` 등                                       | 높음(누락 시 KeyError)     | 필수키 목록                                            |
|  6 | static_parties 필수키   | shipper/consignee/notify/project/po/origin 등                        | 높음(누락 시 KeyError)     | 필수키 목록                                            |
|  7 | Rider items          | 없으면 자동 1줄 생성 가능                                                     | 낮음                    | 자동 생성 규칙                                          |
|  8 | Style‑first 정책       | 서식 동일성 우선, 데이터 부족 시 NULL 유지                                         | 중간(빈칸 증가)             | AutoBuild 가이드                                     |
|  9 | 템플릿 하드코딩 리스크         | 회사명/서명 문구 등이 코드 상수로 고정 가능                                           | 중간~높음(타사 적용 시 오염)     | 하드코딩/선택지 명시                                       |
| 10 | KPI 게이트 운영           | GPTS 모드는 Soft Warning(차단 없음)                                        | 낮음(운영 유연) / 중간(오류 유입) | Soft Warning 정책                                   |

---

## Options A/B/C ( $ / Risk / Time )

### 옵션 A — “GPT 단독 + Data Analysis” MVP(현 구조 유지)

* $: 낮음(AED 0.00 ~ 내부 인력)
* Risk: 중간(세션 파일/SSoT 접근성, 필수키 누락 시 실패 가능)
* Time: 낮음
* 핵심 조치: **프리필 어댑터(필수키 누락 시 빈값/0.00 채움 + warnings 기록)**만 추가하면 “기본 정보만으로도 생성”에 가장 빠르게 근접.

### 옵션 B — “GPT + Actions + 사내 백엔드 빌더” 운영형

* $: 높음
* Risk: 낮음(버전관리/재현성/감사추적 강화)
* Time: 높음
* 핵심 조치: GPT는 **추출·정규화·검증(LLM 강점)**에 집중하고, Excel 생성은 백엔드에서 **SSoT 고정 + CI/CD + 회귀테스트**로 책임. (문서에서도 장기 정답으로 제시) 

### 옵션 C — 하이브리드(단기 A + 중기 B 전환)

* $: 중간
* Risk: 중간→낮음(전환 시 감소)
* Time: 중간
* 핵심 조치: A로 “현업 사용성”을 검증하면서, 동시에 **CIPL_INPUT 스키마/테스트팩/템플릿 상수 분리**를 준비해 B로 전환.

---

## 개선점 / 추가 아이디어(우선순위 순)

### 1) “프리필(placeholder) 어댑터”로 최소입력 모드 구현(필수)

* 문제: `CIPL.py`의 `_require()` 특성상 필수키 누락은 즉시 실패 
* 개선: `commons/static_parties`에 대해

  * 문자열 필드: `""`(빈칸) 또는 `"UNKNOWN"` 중 택1(권장: 빈칸)
  * 숫자 필드: `0.00` (CBM은 템플릿상 3 decimals 기대 → `0.000`) 
  * 그리고 **warnings[]에 “가정: 필수키 누락으로 빈칸/0.00 처리”**를 누적.
* 효과: 사용자가 “기본 정보만 제공”해도 **서식은 100% 유지(Style‑first) + 데이터는 비어있음** 형태로 항상 산출 가능. 

### 2) CIPL_INPUT JSON Schema를 SSoT로 고정(자동 검증)

* GUIDE의 매핑테이블을 그대로 **스키마(타입/필수/허용값)**로 승격하면, 추출 품질이 낮아도 “실패 대신 경고”로 제어가 가능합니다. 
* 추가: 스키마 검증 결과를 LDG_AUDIT에 `schema_findings[]`로 넣어 Human Gate 효율화.

### 3) 템플릿 상수 분리(회사명/서명/문구/로고)

* 템플릿에 하단 문구 등이 하드코딩되어 있을 수 있어, 데이터만 교체하면 “형식 오염” 리스크가 남습니다. 
* 개선: `constants.py`(또는 JSON)로 분리 후 템플릿에서 참조 → 프로젝트별/법인별 프로파일 지원.

### 4) 회귀테스트를 “서식 동일성” 중심으로 자동화

* PIPELINE에 이미 `compare_outputs.py`, `verify_visual_output.py`가 있고, AutoBuild 가이드는 Merge/Border/Print Area 등 서식 테스트를 강조합니다.  
* 개선: “대표 20세트(정상 10 + 난이도 10)”를 정식 테스트팩으로 고정(문서에도 필요성 명시). 

### 5) Knowledge 한계 대응: 입력 라우팅/전처리 정책 강화

* Knowledge는 멀티컬럼 PDF 취약, 이미지 텍스트 미처리 제한이 있어(텍스트만) 스캔본에서 누락이 발생할 수 있습니다. ([OpenAI Help Center][2])
* 개선: “스캔 PDF 의심” 시 **사용자에게 스크린샷 업로드 유도**(질문 최소화 원칙 유지하되, 실패율을 낮추는 *단일 안내*) + OCR KPI를 Audit에 명시.

### 6) Actions 전환 시(옵션 B/C) 보안/운영 포인트

* Actions 운영 문서의 권장사항(예: rate limit, timeout 등)을 기준으로, **사내 API 게이트웨이/로깅/키관리**를 포함한 운영설계를 권장합니다. ([OpenAI Platform][3])

---

## Steps (P → Pi → B → O → S + KPI)

### P (Prepare)

* GPT Configure

  * Code Interpreter & Data Analysis: **ON**(파일 산출/다운로드 전제) ([OpenAI Help Center][1])
  * Knowledge: SSoT 문서/가이드 업로드(참조용) + “파일명 노출/민감정보 출력 금지” 지침 강화 ([OpenAI Help Center][2])
* SSoT 파일(빌더/매퍼/템플릿/로고) 접근 전략 확정: “세션 업로드 vs 고정 관리” 

### Pi (Parse & interpret)

* 입력 번들(여러 파일)에서 Invoice/BL/PL/CIPL를 분류하고, LDG_PAYLOAD v2.4 생성(불확실은 NULL) 

### B (Build)

* LDG_PAYLOAD → Commons Mode 변환(매핑테이블 준수) 
* **프리필 어댑터 적용**(필수키 누락 시 빈칸/0.00)
* `make_cipl_set.py` 실행 → 4‑sheet Excel 생성 

### O (Operate)

* Soft Warning 운영(차단 대신 경고 + Human Gate) 
* ZERO는 “치명 실패 3종”에 한정(SSoT 로드/입력 파손/저장 실패) 

### S (Scale + KPI)

* 회귀테스트 자동화(서식 동일성) + KPI 리포팅(MeanConf/TableAcc/NumericIntegrity) 
* 필요 시 Actions로 Excel 생성 분리(버전관리/재현성 강화) ([OpenAI Platform][3])

---

## (Auto/QA)

* 자동 체크(권장)

  * `CIPL_INPUT` 스키마 검증(필수키/타입) → 실패 시 프리필 적용 + warnings 기록
  * 출력물 회귀테스트: `compare_outputs.py` + `verify_visual_output.py` 
* 품질 표시(권장): AutoBuild의 A/B/C 등급 체계를 UI에 노출(생성은 항상 YES, Human Gate만 가중). 

---

## Acc(가정:)

* 가정: 현재 빌더는 `commons/static_parties` 필수키 누락 시 실패할 수 있으므로(문서에 KeyError 경로 명시), “기본 정보만으로도 생성”을 위해 프리필 어댑터를 설계 변경 항목으로 포함했습니다.  
* 가정: Knowledge는 참조에는 유효하지만, 멀티컬럼/이미지 기반 문서는 한계가 있으므로 입력 라우팅과 Human Gate를 운영 전제로 둡니다. ([OpenAI Help Center][2])

---

## 🔧 /cmd3 (Now / Next / Alt)

* Now: `/logi-master --deep report`  (현 문서 기준 “필수키 프리필 어댑터” 설계안 + CIPL_INPUT 스키마 초안까지 한 번에 산출)
* Next: `/logi-master --fast report`  (Configure/Instructions/테스트팩 체크리스트만 빠르게)
* Alt: `/switch_mode COST-GUARD`  (CI/PL 금액/수량/중량/CBM 불일치 Δ 리포트 포맷 우선 설계)

---

## ZERO log

* ZERO: 해당 없음(요청은 “아키텍처 점검/개선 제안”이며, 실시간 요율/통관/HS 확정/날씨/ETA 등 출처 필수 영역이 아님).

[1]: https://help.openai.com/en/articles/11325361-why-cant-i-download-files-generated-by-my-custom-gpt "Why can't I download files generated by my custom GPT? | OpenAI Help Center"
[2]: https://help.openai.com/en/articles/8843948-knowledge-in-gpts "Knowledge in GPTs | OpenAI Help Center"
[3]: https://platform.openai.com/docs/actions/production "Production notes on GPT Actions"
