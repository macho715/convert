Option Explicit

'========================================================
' Document_Tracker Sheet Module
' 자동으로 Last Updated / Updated By 기록
'========================================================
Private Sub Worksheet_Change(ByVal Target As Range)
    On Error GoTo EH

    Dim lo As ListObject
    Set lo = Me.ListObjects("tblTracker")

    Dim rngWatch As Range
    Set rngWatch = Union( _
        lo.ListColumns("Status").DataBodyRange, _
        lo.ListColumns("Submitted Date").DataBodyRange, _
        lo.ListColumns("Approved/Received Date").DataBodyRange, _
        lo.ListColumns("Remarks").DataBodyRange _
    )

    If Intersect(Target, rngWatch) Is Nothing Then Exit Sub

    Application.EnableEvents = False

    Dim rowIdx As Long
    rowIdx = Target.Row - lo.DataBodyRange.Row + 1
    If rowIdx < 1 Or rowIdx > lo.DataBodyRange.Rows.Count Then GoTo SafeExit

    lo.ListColumns("Last Updated").DataBodyRange.Cells(rowIdx, 1).Value = Now
    lo.ListColumns("Updated By").DataBodyRange.Cells(rowIdx, 1).Value = Environ$("username")

SafeExit:
    Application.EnableEvents = True
    Exit Sub

EH:
    Application.EnableEvents = True
End Sub
